<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>变流器负载试验中的能量回馈装置 | 穿过海的声音</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">变流器负载试验中的能量回馈装置</h1><a id="logo" href="/.">穿过海的声音</a><p class="description">花开堪折直须折 莫待无花空折枝✌️</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">变流器负载试验中的能量回馈装置</h1><div class="post-meta">2020-05-08</div><div class="post-content"><h3 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h3><p>设计并制作一个变流器及负载试验时的能量回馈装置，其结构如图1所示。<br>变流器进行负载试验时，需在其输出端接负载。通常情况下，输出电能消耗在该负载上。为了节能，应进行能量回馈。负载试验时，变流器1（逆变器）将直流电变为交流电，其输出通过连接单元与变流器2（整流器）相连，变流器2将交流电转换成直流电，并回馈至变流器1的输入端，与直流电源一起共同给变流器1供电，从而实现了节能。<br><img src="/media/model.jpg" alt="model"></p>
<h3 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h3><ul>
<li>变流器1输出端c、d仅连接电阻性负载，变流器1能输出50Hz、25V0.25V、2A的单相正弦交流电。</li>
<li>在要求（1）的条件下，变流器1输出交流电的频率范围可设定为20Hz～100H，<br>步进1Hz。</li>
<li>变流器1与能量回馈装置按图1所示连接，系统能实现能量回馈，变流器1输出电流I1 &#x3D; 1A。  </li>
<li>变流器1与能量回馈装置按图1所示连接，变流器1输出电流I1 &#x3D; 2A，要求直流电源输出功率Pd越小越好。 </li>
<li>其他。</li>
<li>设计报告。</li>
</ul>
<h3 id="大致方案"><a href="#大致方案" class="headerlink" title="大致方案"></a>大致方案</h3><p>本设计以单片机最小系统板为控制核心，协调各个模块工作以实现题设功能。电路分为DC-AC、AC-DC这两个主模块。其中DC-AC模块由PWM控制信号驱动电路、全桥逆变电路、电压电流采样电路、电压转换电路组成，AC-DC由桥式整流电路、稳压电路、驱动电路等组成。单片机STM32F103RCT6产生的信号通过驱动电路、全桥逆变电路产生不同占空比的方波，通过电压电流采样电路变换为正弦波信号，同时反馈至STM32，由程序PID算法进行控制稳压；由DC-AC产生的信号传入AC-DC模块，当信号传入桥式整流电路，通过二极管的导通与截止，使交流信号重新转变为直流信号；再通过稳压电路将直流信号反馈至输入端同输入直流电源共同供电，实现能量回馈。<br><img src="/media/result.jpg" alt="result"></p>
<h3 id="参数计算"><a href="#参数计算" class="headerlink" title="参数计算"></a>参数计算</h3><ul>
<li>在变流器输出端加入负载，通过设计要求的电压和电流，可求测量值为R&#x3D;U&#x2F;I&#x3D;12.5Ω。</li>
<li>采用一阶LC滤波低通无源滤波。电路信号中的调制波频率为50Hz载波频率为18KHz，所以设置滤波器的截止频率为100Hz，电感L和电容C取值可按照如下公式选取：f &#x3D; 1 &#x2F; (2 * pi * sqrt(L * C))，所需的频带为20HZ-100HZ，可以设计通频带为0到100HZ的低通滤波器，经计算L&#x3D;3mh，C&#x3D;106PF。</li>
<li>输出功率计算：Pd &#x3D; U * I。</li>
<li>PWM波的计算:<br>一个脉冲的频率: f &#x3D; fDSC &#x2F;（8 * ARR）;<br>一个周期频率:  f &#x3D; fosc &#x2F;（8 * ARR * 180）;<br>通过改变ARR,改变每个脉冲频率，从而改变步进为1HZ 。</li>
</ul>
<h3 id="DC-AC逆变器电路"><a href="#DC-AC逆变器电路" class="headerlink" title="DC-AC逆变器电路"></a>DC-AC逆变器电路</h3><p>STM32软件编程，使之产生脉冲宽度按正弦规律变化的PWM 波形，并由IR2304集成电路驱动，该波形通过LC低通滤波器，使之转换为正弦波，在采样电路处给单片机稳压，通过软件编程PID，使之输出稳定。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!(p-&gt;deg_cnt &amp; <span class="number">0x80000000</span>))</span><br><span class="line">&#123;</span><br><span class="line">	TIM_SetCompare1(TIM1, i);</span><br><span class="line">	TIM_SetCompare2(TIM1, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	TIM_SetCompare2(TIM1, i);</span><br><span class="line">	TIM_SetCompare1(TIM1, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如图，代码中输出不同占空比的pwm是由四个mos管来控制，这四个二极管是由单片机自己输出的不同占空比的pwm波控制的（定时器1），首先右下角二极管一直导通接地，右上角二极管关闭，左边的两个二极管轮流导通，就能输出不同占空比的pwm波；然后左下角二极管一直导通，左上角关闭，右边两个二极管轮流导通，这样就输出了与前一个波形反向的pwm波。然后经过滤波输出为正弦波。<br>为了稳定输出的正弦波，使用了ADC采样反馈，然后通过PID稳定正弦波。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ADC部分配置</span></span><br><span class="line">ADC_InitStructure.ADC_ExternalTrigConv = ADC_ExternalTrigConv_T4_CC4; <span class="comment">//转换由定时器4外部触发启动 </span></span><br><span class="line">ADC_ExternalTrigConvCmd(ADC1, ENABLE); <span class="comment">//外部触发</span></span><br><span class="line">DMA_Cmd(DMA1_Channel1, ENABLE ); </span><br><span class="line">ADC_InitStructure.ADC_ContinuousConvMode = DISABLE; <span class="comment">//模数转换工作在单次转换模式</span></span><br><span class="line">ADC_InitStructure.ADC_ExternalTrigConv = ADC_ExternalTrigConv_T4_CC4; <span class="comment">//转换由定时器4外部触发启动</span></span><br><span class="line">ADC_InitStructure.ADC_NbrOfChannel = <span class="number">2</span>; <span class="comment">//顺序进行规则转换的ADC通道的数目, out1和out2</span></span><br><span class="line">ADC_InitStructure.ADC_ScanConvMode = ENABLE; <span class="comment">//转换是扫描（多通道模式）还是单个转换（单通道模式）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ADC1_TRIG_PERIOD	100 <span class="comment">//200uS PWM, ADC采样周期</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ADC1_PERIOD_CNT		(20000/ADC1_TRIG_PERIOD) <span class="comment">//一个正弦周期采样点</span></span></span><br><span class="line">TIM_TimeBaseStructure.TIM_Period = (ADC1_TRIG_PERIOD<span class="number">-1</span>);</span><br><span class="line">g_adc_val.adc_cnt_thre=ADC1_PERIOD_CNT;</span><br><span class="line">g_adc_val.acv_set=<span class="number">25</span>;</span><br><span class="line">ADC_RegularChannelConfig(ADC1, ADC_Channel_5, <span class="number">1</span>, ADC_SampleTime_71Cycles5 );	<span class="comment">//ADC1,ADC通道,采样时间为239.5周期 AD TEMPER4</span></span><br></pre></td></tr></table></figure>

<p>多通道AD采集需要使用DMA：不论是单次采集还是多次采集，转换完成的数据都会放在同一个地方。由于ADC_DR寄存器不是一个数组，而是一个16位的变量，所以只能保存最新的转换结果。运用STM32的DMA功能，可以更好地解决结果被覆盖的问题。重点：用于高速搬运数据，还无需CPU干预。 因此在多通道采集模拟量是，我们可以建立一个数组，用于储存AD转换的数据。一旦ADC_DR寄存器里有了新的数据，就把新数据放在数组里。一会儿ADC_DR有了一个新的数据，就放在数组下一位。数组装满以后？根据需求来。我们设置的是循环模式，也就是再来一遍，覆盖之前的数据。</p>
<p><img src="/media/DC-AC.jpg" alt="DC-AC"></p>
<p>由于是用正弦波类型的占空比通过驱动电路驱动mos管，但是在C语言中用sin函数很耗时间，而我们产生的正弦波若频率较高，那么可能时间会来不及，所以我们先自己算好sin的值然后乘以32767（大约65536的一半），做成一个数组，到时候只需要查表即可，大大减少了时间。</p>
<h3 id="AC-DC整流器电路"><a href="#AC-DC整流器电路" class="headerlink" title="AC-DC整流器电路"></a>AC-DC整流器电路</h3><p>正弦波通过变压器，经过桥式整流电路，通过二极管的导通与截止，使交流信号重新转变为直流信号，再通过PFC功率因数校正电路将直流信号反馈至输入端同输入直流电源共同供电，实现能量回馈，此电路由STM32控制驱动电路操控。</p>
<h3 id="整体程序功能描述与设计思路"><a href="#整体程序功能描述与设计思路" class="headerlink" title="整体程序功能描述与设计思路"></a>整体程序功能描述与设计思路</h3><p>该程序分能大致分为四个主要任务：初始化定时器任务、ADC采样、PWM输出、低线程任务（OLED显示）。各个定时器的配置主要有Timer1的模块1-3作为3相互补输出,updata中断对角度增量,模块4作为捕获输入,输入来自PLL的输出；Timer2的模块1作为PLL输入捕获,模块2作为波形反馈输入捕获；Timer4的模块4作为ADC外部触发。ADC采样主要对DC-AC交流器输出电压进行采样，得到电压值并且反馈使系统更加稳定。PWM通过不断设置定时器的CCR寄存器来不断改变输出的脉冲波的占空比，并且通过改变ARR寄存器的值使输出信号频率可调，输出的脉冲波经过滤波即可得到正弦波。</p>
<h3 id="注"><a href="#注" class="headerlink" title="注"></a>注</h3><p>任务要求先做一个变流器DC-AC，然后接负载，大部分电能都会消耗在负载，所以又在后面设计了一个AC-DC装置，将电能回馈到直流电源电源一起供电，从而节能。</p>
<center><font face="黑体" size=2 color=gray>本人才疏学浅，若有任何不严谨或者错误的地方，欢迎指正：Scotteland@163.com</font></center></div><div class="tags"><a href="/tags/Project/"><i class="fa fa-tag"></i>Project</a><a href="/tags/C/"><i class="fa fa-tag"></i>C</a></div><div class="post-nav"><a class="next" href="/2020/05/06/%E5%9F%BA%E4%BA%8E%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F/">基于单片机的远程控制系统</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/OJ/" style="font-size: 15px;">OJ</a> <a href="/tags/Project/" style="font-size: 15px;">Project</a> <a href="/tags/C/" style="font-size: 15px;">C</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/08/%E5%8F%98%E6%B5%81%E5%99%A8%E8%B4%9F%E8%BD%BD%E8%AF%95%E9%AA%8C%E4%B8%AD%E7%9A%84%E8%83%BD%E9%87%8F%E5%9B%9E%E9%A6%88%E8%A3%85%E7%BD%AE/">变流器负载试验中的能量回馈装置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/06/%E5%9F%BA%E4%BA%8E%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F/">基于单片机的远程控制系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/06/%E8%B6%85%E5%B8%82%E8%B4%AD%E7%89%A9%E6%9C%BA%E5%99%A8%E4%BA%BA/">超市购物机器人</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/22/HDU-Page11(2067%EF%BD%9E2080)%20/">HDU Page11(2067～2080)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/HDU-Page11(2059%EF%BD%9E2062)/">HDU-Page11(2059～2062)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/HDU-Page11-2041%EF%BD%9E2050%E9%80%92%E6%8E%A8/">HDU Page11(2041～2050)递推</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/HDU-Page11(2051%EF%BD%9E2065)/">HDU Page11(2051～2066)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/HDU-Page11(2081%EF%BD%9E2099)/">HDU-Page11(2081～2099)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/10/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">穿过海的声音.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>