<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>redis_1 | 穿过海的声音</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">redis_1</h1><a id="logo" href="/.">穿过海的声音</a><p class="description">花开堪折直须折，莫待无花空折枝✌️</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">redis_1</h1><div class="post-meta">2022-05-13</div><div class="post-content"><h3 id="Redis-Remote-Dictionary-Server"><a href="#Redis-Remote-Dictionary-Server" class="headerlink" title="Redis(Remote Dictionary Server)"></a>Redis(Remote Dictionary Server)</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1cr4y1671t?spm_id_from=333.337.search-card.all.click">视频教程：全面透析redis底层原理+redis分布式锁+企业解决方案+redis实战</a></p>
<p>redis是基于内存的，速度快；IO多路复用；有丰富的数据类型，合适的选择可以提高运行效率。</p>
<h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><p>setnx加ex超时，配合lua，分布式锁。</p>
<p>有自增自减操作（INCR -1），SETNX，将对象序列化为JSON字符串后存储</p>
<p>缓存击穿中热点key加互斥锁的时候可以用SETNX来实现（）</p>
<p>分布式中全局唯一ID，每天一个key（方便统计）、ID构造是 时间戳 + 计数器（自增实现）</p>
<h4 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h4><p>可重入锁，field是threadid，value是次数，配合lua。</p>
<p>无序字典，里面会有对应域和值，可对单个字段做独立的CRUD</p>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>异步队列，生产者消费者，下的单进行消费，但是单一消费者。</p>
<p>双向链表，插入和删除快</p>
<p>可用BLPOP和RPUSH，或者BRPOP和LPUSH，实现阻塞队列，缺点：</p>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><p>与hashset，可看作value为null的hashmap，无序、不重复，查找快，交集、并集、差集等</p>
<p>比如看自己跟别人的共同关注列表</p>
<h4 id="SortedSet"><a href="#SortedSet" class="headerlink" title="SortedSet"></a>SortedSet</h4><p>每一条博客下面，按照用户点赞时间排序给用户排序。</p>
<p>底层实现是skiplist跳表+hash表</p>
<p>根据score排序，不重复，查询快</p>
<p>用来做排行榜等</p>
<h4 id="GEO和BitMap"><a href="#GEO和BitMap" class="headerlink" title="GEO和BitMap"></a>GEO和BitMap</h4><p>&#x3D;&#x3D;geo&#x3D;&#x3D;获取附近商铺信息</p>
<p>&#x3D;&#x3D;bitmap&#x3D;&#x3D;比如每日签到，签到统计</p>
<p>注意</p>
<p>GEO是sortedset的实现</p>
<p>bitmap其实是&#x3D;&#x3D;string数据类型&#x3D;&#x3D;实现</p>
<h4 id="新的数据类型Stream，消息队列"><a href="#新的数据类型Stream，消息队列" class="headerlink" title="新的数据类型Stream，消息队列"></a>新的数据类型Stream，消息队列</h4><h3 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h3><p>客户端请求的，在缓存中和数据库中都不存在</p>
<ol>
<li>缓存空对象（+TTL）</li>
<li>布隆过滤（BitMap实现）（多一层前置过滤，存在误判）</li>
</ol>
<h3 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h3><p>同一时间大量缓存的key同时失效 或 Redis服务宕机，大量的请求到达服务器</p>
<p>针对不同的有不同的方法，给不同的key的TTL添加波动的随机值；Redis集群，主从集群</p>
<p>&#x3D;&#x3D;但是如果真的出现了，也要考虑。&#x3D;&#x3D;给缓存业务添加降级限流策略，给业务添加多级缓存。</p>
<h3 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h3><p>热点key都会首先缓存到redis中的。</p>
<p>热点key问题，被高并发访问并且缓存重建业务复杂（重建的时间内大量的访问）的key失效了。</p>
<p>解决：互斥锁（SETNX（），需要TTL防止程序异常。一致性）；逻辑过期（不用TTl自己维护一个expire，也要获锁新开线程。可用性，无需等待，但是期间拿到的是旧数据）</p>
<p>HyperLogLog做UV统计</p>
<p>pipeline批量导入数据，pipeline的多个命令之间不具备原子性，mset和pipeline这样的批处理，如果是在集群中，那么批处理命令的多个key必须落在一个插槽中。</p>
<h4 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h4><p>RDB和AOF</p>
<h4 id="主从和哨兵（高可用、高并发读）"><a href="#主从和哨兵（高可用、高并发读）" class="headerlink" title="主从和哨兵（高可用、高并发读）"></a>主从和哨兵（高可用、高并发读）</h4><p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_0301A08F2931-1.jpg" alt="IMG_0301A08F2931-1.jpg"></p>
<p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_5AD953718C41-1.jpg" alt="IMG_5AD953718C41-1.jpg"></p>
<p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_F7B6AAA32E9D-1.jpg" alt="IMG_F7B6AAA32E9D-1.jpg"></p>
<p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_2015.jpg" alt="IMG_2015.jpg"></p>
<h4 id="分片（海量数据存储、高并发写）"><a href="#分片（海量数据存储、高并发写）" class="headerlink" title="分片（海量数据存储、高并发写）"></a>分片（海量数据存储、高并发写）</h4><p>散列插槽，数据key与插槽绑定（16384个插槽分配到不同的实例，根据有小部分计算哈希值，取余）</p>
<h4 id="多级缓存"><a href="#多级缓存" class="headerlink" title="多级缓存"></a>多级缓存</h4><h5 id="OpenResty"><a href="#OpenResty" class="headerlink" title="OpenResty"></a>OpenResty</h5><h5 id="Redis缓存预热"><a href="#Redis缓存预热" class="headerlink" title="Redis缓存预热"></a>Redis缓存预热</h5><h4 id="缓存同步"><a href="#缓存同步" class="headerlink" title="缓存同步"></a>缓存同步</h4><p>数据库的主从同步原理</p>
<p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_09705D2FEE35-1.jpg" alt="IMG_09705D2FEE35-1.jpg"></p>
<p>设置有效期外失效，同步双写强一致性（修改完数据库修改缓存形成事务），异步通知</p>
<p>异步通知，第一种是基于&#x3D;&#x3D;MQ&#x3D;&#x3D;的异步通知，需要手写发布监听，然后更新；第二种是canal，把自己伪装成一个MYSQL的slave节点，从而坚挺binary log的变化，再把得到的变化信息通知给canal的客户端，进而完成对其他数据库的同步。所以要用canal，要先实现mysql的主从。</p>
<p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_33E435DAFCBC-1.jpg" alt="IMG_33E435DAFCBC-1.jpg"></p>
<h4 id="AOP：事务"><a href="#AOP：事务" class="headerlink" title="AOP：事务"></a>AOP：事务</h4><h4 id="SDS动态字符串"><a href="#SDS动态字符串" class="headerlink" title="SDS动态字符串"></a>SDS动态字符串</h4><p>redis没有直接使用c的字符串（获取长度需要遍历，非二进制安全，不可修改）</p>
<p>SDS中有buf[]，一保存字符串长度，申请总字节数，不同头类型大小，可以动态扩容</p>
<h4 id="IntSet"><a href="#IntSet" class="headerlink" title="IntSet"></a>IntSet</h4><p>唯一、长度可变、有序、二分查找来查询</p>
<h4 id="Dict"><a href="#Dict" class="headerlink" title="Dict"></a>Dict</h4><p>dict由三部分组成：哈希表、哈希节点、字典。一个dict中有两个哈希表bictht，一个用于存储，一个用于扩容再哈希使用。哈希表中是数组结合单向链表实现解决hash冲突，类似java的hashtable，当个数到达一定的时候，会扩容收缩（伴随再hash）。</p>
<p>非连续，碎片多</p>
<h4 id="ZipList"><a href="#ZipList" class="headerlink" title="ZipList"></a>ZipList</h4><p>一个特殊的“双端链表”，由一系列特殊编码的连续内存组成，用1字节或者5字节保存前一节点的长度而不是用指针记录前后节点。</p>
<h4 id="QuickList"><a href="#QuickList" class="headerlink" title="QuickList"></a>QuickList</h4><p>一个双端链表，链表中的每一个节点都是一个ziplist。（LinkedList+ZipList）使用的ziplist，解决了传统链表的内存占用问题（碎片），控制每一个zipilst大小，解决了连续内存空间申请的效率问题，中间节点可以压缩进一步节省内存。</p>
<h4 id="SkipList跳表"><a href="#SkipList跳表" class="headerlink" title="SkipList跳表"></a>SkipList跳表</h4><p>链表，升序排序，节点包含多个后指针，跨度不同，前驱指针只有一个</p>
<h4 id="RedisObject"><a href="#RedisObject" class="headerlink" title="RedisObject"></a>RedisObject</h4><p>Redis的任意数据类型的键和值都会被封装为一个RedisObject，也叫Redis对象。</p>
<h4 id="五种数据结构是如何的"><a href="#五种数据结构是如何的" class="headerlink" title="五种数据结构是如何的"></a>五种数据结构是如何的</h4><p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_2026.jpg" alt="IMG_2026.jpg"></p>
<p>网络模型</p>
<p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_2047.jpg" alt="IMG_2047.jpg"></p>
<p>为什么redis单线程</p>
<p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_2056.jpg" alt="IMG_2056.jpg"></p>
<h4 id="内存回收"><a href="#内存回收" class="headerlink" title="内存回收"></a>内存回收</h4><p><img src="https://pic.tyzhang.top/images/2022/05/26/IMG_2060.jpg" alt="IMG_2060.jpg"></p>
</div><div class="tags"><a href="/tags/Java/"><i class="fa fa-tag"></i>Java</a><a href="/tags/Redis/"><i class="fa fa-tag"></i>Redis</a></div><div class="post-nav"><a class="pre" href="/2022/05/13/redis-practice/">redis_practice</a><a class="next" href="/2020/05/08/%E5%8F%98%E6%B5%81%E5%99%A8%E8%B4%9F%E8%BD%BD%E8%AF%95%E9%AA%8C%E4%B8%AD%E7%9A%84%E8%83%BD%E9%87%8F%E5%9B%9E%E9%A6%88%E8%A3%85%E7%BD%AE/">变流器负载试验中的能量回馈装置</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/OJ/" style="font-size: 15px;">OJ</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Project/" style="font-size: 15px;">Project</a> <a href="/tags/C/" style="font-size: 15px;">C</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/05/13/redis-practice/">redis_practice</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/05/13/redis-1/">redis_1</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/08/%E5%8F%98%E6%B5%81%E5%99%A8%E8%B4%9F%E8%BD%BD%E8%AF%95%E9%AA%8C%E4%B8%AD%E7%9A%84%E8%83%BD%E9%87%8F%E5%9B%9E%E9%A6%88%E8%A3%85%E7%BD%AE/">变流器负载试验中的能量回馈装置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/06/%E5%9F%BA%E4%BA%8E%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F/">基于单片机的远程控制系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/06/%E8%B6%85%E5%B8%82%E8%B4%AD%E7%89%A9%E6%9C%BA%E5%99%A8%E4%BA%BA/">超市购物机器人</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/22/HDU-Page11(2067%EF%BD%9E2080)%20/">HDU Page11(2067～2080)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/HDU-Page11(2059%EF%BD%9E2062)/">HDU-Page11(2059～2062)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/HDU-Page11-2041%EF%BD%9E2050%E9%80%92%E6%8E%A8/">HDU Page11(2041～2050)递推</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/HDU-Page11(2051%EF%BD%9E2065)/">HDU Page11(2051～2066)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/15/HDU-Page11(2081%EF%BD%9E2099)/">HDU-Page11(2081～2099)</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">穿过海的声音.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>